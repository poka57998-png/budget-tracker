<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>–£—á—ë—Ç —Ä–∞—Å—Ö–æ–¥–æ–≤ üí∏</title>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#3b82f6">
<style>
  :root {
    --blue: #3b82f6;
    --red: #ef4444;
    --green: #16a34a;
    --bg: #f8fafc;
  }
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto;
    margin: 0;
    background: var(--bg);
    color: #222;
  }
  header {
    background: var(--blue);
    color: #fff;
    text-align: center;
    padding: 14px;
    font-size: 18px;
    font-weight: 600;
  }
  .container {
    max-width: 480px;
    margin: 0 auto;
    padding: 14px;
  }
  .card {
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.08);
    padding: 16px;
  }
  .form-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-bottom: 8px;
  }
  select, input, button {
    font-size: 16px;
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #ccc;
    flex: 1;
  }
  input[type="number"] { max-width: 120px; }
  button {
    background: var(--blue);
    color: white;
    border: none;
    cursor: pointer;
    flex: none;
    transition: 0.2s;
  }
  button:hover { background: #2563eb; }
  #list {
    margin-top: 12px;
    max-height: 320px;
    overflow-y: auto;
  }
  .item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #eee;
    padding: 8px 0;
  }
  .item.income span { color: var(--green); }
  .item.expense span { color: var(--red); }
  #total {
    margin-top: 14px;
    font-weight: bold;
    text-align: center;
    font-size: 18px;
  }
  #monthly {
    background: #f1f5f9;
    border-radius: 10px;
    margin-top: 16px;
    padding: 10px;
    font-size: 15px;
  }
  .actions {
    display: flex;
    justify-content: center;
    margin-top: 12px;
  }
  #clearBtn { background: var(--red); }
  #clearBtn:hover { background: #dc2626; }
  @media (max-width: 480px) {
    input, select, button { width: 100%; font-size: 17px; }
    .form-row { flex-direction: column; }
  }
</style>
</head>
<body>

<header>üí∞ –£—á—ë—Ç –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</header>
<div class="container">
  <div class="card">
    <div class="form-row">
      <select id="type">
        <option value="income">–î–æ—Ö–æ–¥</option>
        <option value="expense">–†–∞—Å—Ö–æ–¥</option>
      </select>
    </div>
    <div class="form-row">
      <input type="text" id="desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∑–∞—Ä–ø–ª–∞—Ç–∞)">
    </div>
    <div class="form-row">
      <input type="number" id="amount" placeholder="–°—É–º–º–∞" inputmode="decimal">
      <input type="date" id="date">
    </div>
    <div class="form-row">
      <button onclick="addRecord()">–î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
    </div>
    <div id="list"></div>
    <div id="total">–ë–∞–ª–∞–Ω—Å: 0 ‚Ç∏</div>
    <div class="actions">
      <button id="clearBtn" onclick="clearData()">–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë</button>
    </div>
  </div>
</div>

<script>
  let records = JSON.parse(localStorage.getItem('records')) || [];

  function saveRecords() {
    localStorage.setItem('records', JSON.stringify(records));
  }

  function addRecord() {
    const type = document.getElementById('type').value;
    const desc = document.getElementById('desc').value.trim();
    const amount = Number(document.getElementById('amount').value);
    const date = document.getElementById('date').value || new Date().toISOString().split('T')[0];

    if (!desc || isNaN(amount) || amount <= 0) {
      alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ!');
      return;
    }

    records.push({ id: Date.now(), type, desc, amount, date });
    saveRecords();
    updateDisplay();

    document.getElementById('desc').value = '';
    document.getElementById('amount').value = '';
    document.getElementById('date').value = '';
  }

  function updateDisplay() {
    const list = document.getElementById('list');
    const totalEl = document.getElementById('total');
    list.innerHTML = '';
    let total = 0;

    records.forEach(r => {
      const div = document.createElement('div');
      div.className = 'item ' + r.type;
      div.innerHTML = `
        <span>${r.date} ‚Äî ${r.desc} ‚Äî ${r.amount} ‚Ç∏</span>
        <button onclick="removeRecord(${r.id})">√ó</button>
      `;
      list.appendChild(div);
      if (r.type === 'income') total += r.amount;
      else total -= r.amount;
    });

    totalEl.textContent = `–ë–∞–ª–∞–Ω—Å: ${total} ‚Ç∏`;
    calculateMonthlySummary();
  }

  function removeRecord(id) {
    records = records.filter(r => r.id !== id);
    saveRecords();
    updateDisplay();
  }

  function clearData() {
    if (confirm('–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏?')) {
      records = [];
      localStorage.clear();
      updateDisplay();
    }
  }

  function calculateMonthlySummary() {
    const now = new Date();
    const currentMonth = now.getMonth();
    const currentYear = now.getFullYear();

    let income = 0;
    let expense = 0;

    records.forEach(r => {
      const d = new Date(r.date);
      if (d.getMonth() === currentMonth && d.getFullYear() === currentYear) {
        if (r.type === 'income') income += r.amount;
        else expense += r.amount;
      }
    });

    const existing = document.getElementById('monthly');
    if (existing) existing.remove();

    const summary = document.createElement('div');
    summary.id = 'monthly';
    summary.innerHTML = `
      <b>üìÖ ${now.toLocaleString('ru-RU', { month: 'long', year: 'numeric' })}</b><br>
      –î–æ—Ö–æ–¥: <span style="color:green">${income} ‚Ç∏</span><br>
      –†–∞—Å—Ö–æ–¥: <span style="color:red">${expense} ‚Ç∏</span><br>
      –ß–∏—Å—Ç—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <b>${income - expense} ‚Ç∏</b>
    `;

    document.querySelector('.card').appendChild(summary);
  }

  updateDisplay();

  // üì¶ Service Worker –¥–ª—è –æ—Ñ–ª–∞–π–Ω —Ä–∞–±–æ—Ç—ã
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('sw.js')
        .then(() => console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'))
        .catch(err => console.log('–û—à–∏–±–∫–∞ SW:', err));
    });
  }
</script>
</body>
</html>